<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractMVCGroupManager.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sample-swing-java</a> &gt; <a href="index.source.html" class="el_package">org.codehaus.griffon.runtime.core.mvc</a> &gt; <span class="el_source">AbstractMVCGroupManager.java</span></div><h1>AbstractMVCGroupManager.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2008-2017 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.codehaus.griffon.runtime.core.mvc;

import griffon.core.Context;
import griffon.core.ContextFactory;
import griffon.core.GriffonApplication;
import griffon.core.artifact.GriffonController;
import griffon.core.artifact.GriffonModel;
import griffon.core.artifact.GriffonMvcArtifact;
import griffon.core.artifact.GriffonView;
import griffon.core.mvc.MVCFunction;
import griffon.core.mvc.MVCGroup;
import griffon.core.mvc.MVCGroupConfiguration;
import griffon.core.mvc.MVCGroupConfigurationFactory;
import griffon.core.mvc.MVCGroupFactory;
import griffon.core.mvc.MVCGroupFunction;
import griffon.core.mvc.MVCGroupManager;
import griffon.core.mvc.TypedMVCGroup;
import griffon.core.mvc.TypedMVCGroupFunction;
import griffon.exceptions.ArtifactNotFoundException;
import griffon.exceptions.MVCGroupConfigurationException;
import griffon.exceptions.MVCGroupInstantiationException;
import griffon.util.AnnotationUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.annotation.Nonnull;
import javax.annotation.Nullable;
import javax.inject.Inject;
import java.lang.reflect.Constructor;
import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import static griffon.core.GriffonExceptionHandler.sanitize;
import static griffon.util.GriffonNameUtils.isBlank;
import static griffon.util.GriffonNameUtils.requireNonBlank;
import static java.util.Arrays.asList;
import static java.util.Collections.unmodifiableMap;
import static java.util.Objects.requireNonNull;

/**
 * Base implementation of the {@code MVCGroupManager} interface.
 *
 * @author Andres Almiray
 * @since 2.0.0
 */
public abstract class AbstractMVCGroupManager implements MVCGroupManager {
    protected static final String ERROR_MVCTYPE_BLANK = &quot;Argument 'mvcType' must not be blank&quot;;
    protected static final String ERROR_MVCID_BLANK = &quot;Argument 'mvcId' must not be blank&quot;;
    protected static final String ERROR_CONFIGURATION_NULL = &quot;Argument 'configuration' must not be null&quot;;
    protected static final String ERROR_GROUP_NULL = &quot;Argument 'group' must not be null&quot;;
    protected static final String ERROR_CONFIG_NULL = &quot;Argument 'config' must not be null&quot;;
    protected static final String ERROR_ARGS_NULL = &quot;Argument 'args' must not be null&quot;;
    protected static final String ERROR_NAME_BLANK = &quot;Argument 'name' cannot be blank&quot;;
    protected static final String ERROR_TYPE_NULL = &quot;Argument 'type' cannot be null&quot;;
<span class="fc" id="L72">    private static final Logger LOG = LoggerFactory.getLogger(AbstractMVCGroupManager.class);</span>
    private final GriffonApplication application;

<span class="fc" id="L75">    private final Map&lt;String, MVCGroupConfiguration&gt; configurations = new LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L76">    private final Map&lt;String, MVCGroup&gt; groups = new LinkedHashMap&lt;&gt;();</span>
<span class="fc" id="L77">    private final Object lock = new Object[0];</span>
    private boolean initialized;

    @Inject
    private MVCGroupConfigurationFactory mvcGroupConfigurationFactory;

    @Inject
    private MVCGroupFactory mvcGroupFactory;

    @Inject
    private ContextFactory contextFactory;

    @Inject
<span class="fc" id="L90">    public AbstractMVCGroupManager(@Nonnull GriffonApplication application) {</span>
<span class="fc" id="L91">        this.application = requireNonNull(application, &quot;Argument 'application' must not be null&quot;);</span>
<span class="fc" id="L92">    }</span>

    @Override
    public GriffonApplication getApplication() {
<span class="nc" id="L96">        return application;</span>
    }

    @Nonnull
    public MVCGroupConfiguration newMVCGroupConfiguration(@Nonnull String mvcType, @Nonnull Map&lt;String, String&gt; members, @Nonnull Map&lt;String, Object&gt; config) {
<span class="fc" id="L101">        return mvcGroupConfigurationFactory.create(mvcType, members, config);</span>
    }

    @Nonnull
    public MVCGroup newMVCGroup(@Nonnull MVCGroupConfiguration configuration, @Nullable String mvcId, @Nonnull Map&lt;String, Object&gt; members, @Nullable MVCGroup parentGroup) {
<span class="nc" id="L106">        return mvcGroupFactory.create(configuration, mvcId, members, parentGroup);</span>
    }

    @Nonnull
    @Override
    public Context newContext(@Nullable MVCGroup parentGroup) {
<span class="nc bnc" id="L112" title="All 2 branches missed.">        Context parentContext = parentGroup != null ? parentGroup.getContext() : getApplication().getContext();</span>
<span class="nc" id="L113">        return contextFactory.create(parentContext);</span>
    }

    @Nonnull
    public Map&lt;String, MVCGroupConfiguration&gt; getConfigurations() {
<span class="nc" id="L118">        synchronized (lock) {</span>
<span class="nc" id="L119">            return unmodifiableMap(configurations);</span>
<span class="nc" id="L120">        }</span>
    }

    @Nonnull
    public Map&lt;String, MVCGroup&gt; getGroups() {
<span class="fc" id="L125">        synchronized (lock) {</span>
<span class="fc" id="L126">            return unmodifiableMap(groups);</span>
<span class="nc" id="L127">        }</span>
    }

    @Nonnull
    public MVCGroupConfiguration findConfiguration(@Nonnull String mvcType) {
<span class="nc" id="L132">        requireNonBlank(mvcType, ERROR_MVCTYPE_BLANK);</span>
        MVCGroupConfiguration configuration;
<span class="nc" id="L134">        synchronized (lock) {</span>
<span class="nc" id="L135">            configuration = configurations.get(mvcType);</span>
<span class="nc" id="L136">        }</span>

<span class="nc bnc" id="L138" title="All 2 branches missed.">        if (configuration == null) {</span>
<span class="nc" id="L139">            throw new MVCGroupConfigurationException(&quot;Unknown MVC type '&quot; + mvcType + &quot;'. Known types are &quot; + configurations.keySet(), mvcType);</span>
        }
<span class="nc" id="L141">        return configuration;</span>
    }

    @Nullable
    public MVCGroup findGroup(@Nonnull String mvcId) {
<span class="nc" id="L146">        requireNonBlank(mvcId, ERROR_MVCID_BLANK);</span>
<span class="nc" id="L147">        synchronized (lock) {</span>
<span class="nc" id="L148">            LOG.debug(&quot;Searching group {}&quot;, mvcId);</span>
<span class="nc" id="L149">            return groups.get(mvcId);</span>
<span class="nc" id="L150">        }</span>
    }

    @Nullable
    public MVCGroup getAt(@Nonnull String mvcId) {
<span class="nc" id="L155">        return findGroup(mvcId);</span>
    }

    public final void initialize(@Nonnull Map&lt;String, MVCGroupConfiguration&gt; configurations) {
<span class="fc" id="L159">        requireNonNull(configurations, &quot;Argument 'configurations' must not be null&quot;);</span>
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">        if (configurations.isEmpty()) { return; }</span>
<span class="fc" id="L161">        synchronized (lock) {</span>
<span class="pc bpc" id="L162" title="1 of 2 branches missed.">            if (!initialized) {</span>
<span class="fc" id="L163">                doInitialize(configurations);</span>
<span class="fc" id="L164">                initialized = true;</span>
            }
<span class="pc" id="L166">        }</span>
<span class="fc" id="L167">    }</span>

    public void addConfiguration(@Nonnull MVCGroupConfiguration configuration) {
<span class="fc" id="L170">        requireNonNull(configuration, ERROR_CONFIGURATION_NULL);</span>
<span class="fc" id="L171">        synchronized (lock) {</span>
<span class="pc bpc" id="L172" title="3 of 4 branches missed.">            if (initialized &amp;&amp; configurations.get(configuration.getMvcType()) != null) {</span>
<span class="nc" id="L173">                return;</span>
            }
<span class="fc" id="L175">            configurations.put(configuration.getMvcType(), configuration);</span>
<span class="pc" id="L176">        }</span>
<span class="fc" id="L177">    }</span>

    public void removeConfiguration(@Nonnull MVCGroupConfiguration configuration) {
<span class="nc" id="L180">        requireNonNull(configuration, ERROR_CONFIGURATION_NULL);</span>
<span class="nc" id="L181">        removeConfiguration(configuration.getMvcType());</span>
<span class="nc" id="L182">    }</span>

    public void removeConfiguration(@Nonnull String name) {
<span class="nc" id="L185">        requireNonBlank(name, &quot;Argument 'name' must not be blank&quot;);</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">        if (!isBlank(name)) {</span>
<span class="nc" id="L187">            synchronized (lock) {</span>
<span class="nc" id="L188">                configurations.remove(name);</span>
<span class="nc" id="L189">            }</span>
        }
<span class="nc" id="L191">    }</span>

    protected void addGroup(@Nonnull MVCGroup group) {
<span class="nc" id="L194">        requireNonNull(group, ERROR_GROUP_NULL);</span>
<span class="nc" id="L195">        synchronized (lock) {</span>
<span class="nc" id="L196">            LOG.debug(&quot;Adding group {}:{}&quot;, group.getMvcId(), group);</span>
<span class="nc" id="L197">            groups.put(group.getMvcId(), group);</span>
<span class="nc" id="L198">        }</span>
<span class="nc" id="L199">    }</span>

    protected void removeGroup(@Nonnull MVCGroup group) {
<span class="nc" id="L202">        requireNonNull(group, ERROR_GROUP_NULL);</span>
<span class="nc" id="L203">        synchronized (lock) {</span>
<span class="nc" id="L204">            LOG.debug(&quot;Removing group {}:{}&quot;, group.getMvcId(), group);</span>
<span class="nc" id="L205">            groups.remove(group.getMvcId());</span>
<span class="nc" id="L206">        }</span>
<span class="nc" id="L207">    }</span>

    @Nonnull
    public final Map&lt;String, ? extends GriffonModel&gt; getModels() {
<span class="nc" id="L211">        Map&lt;String, GriffonModel&gt; models = new LinkedHashMap&lt;&gt;();</span>
<span class="nc" id="L212">        synchronized (lock) {</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">            for (MVCGroup group : groups.values()) {</span>
<span class="nc" id="L214">                GriffonModel model = group.getModel();</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                if (model != null) {</span>
<span class="nc" id="L216">                    models.put(group.getMvcId(), model);</span>
                }
<span class="nc" id="L218">            }</span>
<span class="nc" id="L219">        }</span>
<span class="nc" id="L220">        return unmodifiableMap(models);</span>
    }

    @Nonnull
    public final Map&lt;String, ? extends GriffonView&gt; getViews() {
<span class="nc" id="L225">        Map&lt;String, GriffonView&gt; views = new LinkedHashMap&lt;&gt;();</span>
<span class="nc" id="L226">        synchronized (lock) {</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">            for (MVCGroup group : groups.values()) {</span>
<span class="nc" id="L228">                GriffonView view = group.getView();</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">                if (view != null) {</span>
<span class="nc" id="L230">                    views.put(group.getMvcId(), view);</span>
                }
<span class="nc" id="L232">            }</span>
<span class="nc" id="L233">        }</span>
<span class="nc" id="L234">        return unmodifiableMap(views);</span>
    }

    @Nonnull
    public final Map&lt;String, ? extends GriffonController&gt; getControllers() {
<span class="nc" id="L239">        Map&lt;String, GriffonController&gt; controllers = new LinkedHashMap&lt;&gt;();</span>
<span class="nc" id="L240">        synchronized (lock) {</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">            for (MVCGroup group : groups.values()) {</span>
<span class="nc" id="L242">                GriffonController controller = group.getController();</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">                if (controller != null) {</span>
<span class="nc" id="L244">                    controllers.put(group.getMvcId(), controller);</span>
                }
<span class="nc" id="L246">            }</span>
<span class="nc" id="L247">        }</span>
<span class="nc" id="L248">        return unmodifiableMap(controllers);</span>
    }

    @Nonnull
    @Override
    public MVCGroupConfiguration cloneMVCGroupConfiguration(@Nonnull String mvcType, @Nonnull Map&lt;String, Object&gt; config) {
<span class="nc" id="L254">        requireNonBlank(mvcType, ERROR_MVCTYPE_BLANK);</span>
<span class="nc" id="L255">        requireNonNull(config, ERROR_CONFIG_NULL);</span>
<span class="nc" id="L256">        MVCGroupConfiguration configuration = findConfiguration(mvcType);</span>
<span class="nc" id="L257">        Map&lt;String, Object&gt; configCopy = new LinkedHashMap&lt;&gt;();</span>
<span class="nc" id="L258">        configCopy.putAll(configuration.getConfig());</span>
<span class="nc" id="L259">        configCopy.putAll(config);</span>
<span class="nc" id="L260">        return newMVCGroupConfiguration(mvcType, configuration.getMembers(), configCopy);</span>
    }

    @Nonnull
    protected List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull MVCGroupConfiguration configuration, @Nullable String mvcId, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L265">        MVCGroup group = createMVCGroup(findConfiguration(configuration.getMvcType()), mvcId, args);</span>
<span class="nc" id="L266">        return asList(group.getModel(), group.getView(), group.getController());</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    protected &lt;M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVCGroup(@Nonnull MVCGroupConfiguration configuration, @Nullable String mvcId, @Nonnull Map&lt;String, Object&gt; args, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L271">        MVCGroup group = null;</span>
        try {
<span class="nc" id="L273">            group = createMVCGroup(configuration, mvcId, args);</span>
<span class="nc" id="L274">            handler.apply((M) group.getModel(), (V) group.getView(), (C) group.getController());</span>
        } finally {
<span class="nc" id="L276">            try {</span>
<span class="nc bnc" id="L277" title="All 4 branches missed.">                if (group != null) {</span>
<span class="nc" id="L278">                    destroyMVCGroup(group.getMvcId());</span>
                }
<span class="nc" id="L280">            } catch (Exception x) {</span>
<span class="nc" id="L281">                LOG.warn(&quot;Could not destroy group [{}] of type {}&quot;, mvcId, configuration.getMvcType(), sanitize(x));</span>
<span class="nc" id="L282">            }</span>
<span class="nc" id="L283">        }</span>
<span class="nc" id="L284">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;)
    protected void withMVCGroup(@Nonnull MVCGroupConfiguration configuration, @Nullable String mvcId, @Nonnull Map&lt;String, Object&gt; args, @Nonnull MVCGroupFunction handler) {
<span class="nc" id="L288">        MVCGroup group = null;</span>
        try {
<span class="nc" id="L290">            group = createMVCGroup(configuration, mvcId, args);</span>
<span class="nc" id="L291">            handler.apply(group);</span>
        } finally {
<span class="nc" id="L293">            try {</span>
<span class="nc bnc" id="L294" title="All 4 branches missed.">                if (group != null) {</span>
<span class="nc" id="L295">                    destroyMVCGroup(group.getMvcId());</span>
                }
<span class="nc" id="L297">            } catch (Exception x) {</span>
<span class="nc" id="L298">                LOG.warn(&quot;Could not destroy group [{}] of type {}&quot;, mvcId, configuration.getMvcType(), sanitize(x));</span>
<span class="nc" id="L299">            }</span>
<span class="nc" id="L300">        }</span>
<span class="nc" id="L301">    }</span>

    @Nonnull
    protected abstract MVCGroup createMVCGroup(@Nonnull MVCGroupConfiguration configuration, @Nullable String mvcId, @Nonnull Map&lt;String, Object&gt; args);

    protected abstract void doInitialize(@Nonnull Map&lt;String, MVCGroupConfiguration&gt; configurations);

    @Nonnull
    @Override
    public MVCGroup createMVCGroup(@Nonnull String mvcType) {
<span class="nc" id="L311">        return createMVCGroup(findConfiguration(mvcType), null, Collections.&lt;String, Object&gt;emptyMap());</span>
    }

    @Nonnull
    @Override
    public MVCGroup createMVCGroup(@Nonnull String mvcType, @Nonnull String mvcId) {
<span class="nc" id="L317">        return createMVCGroup(findConfiguration(mvcType), mvcId, Collections.&lt;String, Object&gt;emptyMap());</span>
    }

    @Nonnull
    @Override
    public MVCGroup createMVCGroup(@Nonnull Map&lt;String, Object&gt; args, @Nonnull String mvcType) {
<span class="nc" id="L323">        return createMVCGroup(findConfiguration(mvcType), null, args);</span>
    }

    @Nonnull
    @Override
    public MVCGroup createMVCGroup(@Nonnull String mvcType, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L329">        return createMVCGroup(findConfiguration(mvcType), null, args);</span>
    }

    @Nonnull
    @Override
    public MVCGroup createMVCGroup(@Nonnull Map&lt;String, Object&gt; args, @Nonnull String mvcType, @Nonnull String mvcId) {
<span class="nc" id="L335">        return createMVCGroup(findConfiguration(mvcType), mvcId, args);</span>
    }

    @Nonnull
    @Override
    public MVCGroup createMVCGroup(@Nonnull String mvcType, @Nonnull String mvcId, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L341">        return createMVCGroup(findConfiguration(mvcType), mvcId, args);</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; MVC createMVCGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType) {
<span class="nc" id="L347">        return typedMvcGroup(mvcType, createMVCGroup(findConfiguration(nameOf(mvcType)), null, Collections.&lt;String, Object&gt;emptyMap()));</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; MVC createMVCGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId) {
<span class="nc" id="L353">        return typedMvcGroup(mvcType, createMVCGroup(findConfiguration(nameOf(mvcType)), mvcId, Collections.&lt;String, Object&gt;emptyMap()));</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; MVC createMVCGroup(@Nonnull Map&lt;String, Object&gt; args, @Nonnull Class&lt;? extends MVC&gt; mvcType) {
<span class="nc" id="L359">        return typedMvcGroup(mvcType, createMVCGroup(findConfiguration(nameOf(mvcType)), null, args));</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; MVC createMVCGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L365">        return typedMvcGroup(mvcType, createMVCGroup(findConfiguration(nameOf(mvcType)), null, args));</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; MVC createMVCGroup(@Nonnull Map&lt;String, Object&gt; args, @Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId) {
<span class="nc" id="L371">        return typedMvcGroup(mvcType, createMVCGroup(findConfiguration(nameOf(mvcType)), mvcId, args));</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; MVC createMVCGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L377">        return typedMvcGroup(mvcType, createMVCGroup(findConfiguration(nameOf(mvcType)), mvcId, args));</span>
    }

    @Nonnull
    @Override
    public List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull String mvcType) {
<span class="nc" id="L383">        return createMVC(findConfiguration(mvcType), null, Collections.&lt;String, Object&gt;emptyMap());</span>
    }

    @Nonnull
    @Override
    public List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull Map&lt;String, Object&gt; args, @Nonnull String mvcType) {
<span class="nc" id="L389">        return createMVC(findConfiguration(mvcType), null, args);</span>
    }

    @Nonnull
    @Override
    public List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull String mvcType, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L395">        return createMVC(findConfiguration(mvcType), null, args);</span>
    }

    @Nonnull
    @Override
    public List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull String mvcType, @Nonnull String mvcId) {
<span class="nc" id="L401">        return createMVC(findConfiguration(mvcType), mvcId, Collections.&lt;String, Object&gt;emptyMap());</span>
    }

    @Nonnull
    @Override
    public List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull Map&lt;String, Object&gt; args, @Nonnull String mvcType, @Nonnull String mvcId) {
<span class="nc" id="L407">        return createMVC(findConfiguration(mvcType), mvcId, args);</span>
    }

    @Nonnull
    @Override
    public List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull String mvcType, @Nonnull String mvcId, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L413">        return createMVC(findConfiguration(mvcType), mvcId, args);</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull Class&lt;? extends MVC&gt; mvcType) {
<span class="nc" id="L419">        return createMVC(findConfiguration(nameOf(mvcType)), null, Collections.&lt;String, Object&gt;emptyMap());</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull Map&lt;String, Object&gt; args, @Nonnull Class&lt;? extends MVC&gt; mvcType) {
<span class="nc" id="L425">        return createMVC(findConfiguration(nameOf(mvcType)), null, args);</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L431">        return createMVC(findConfiguration(nameOf(mvcType)), null, args);</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId) {
<span class="nc" id="L437">        return createMVC(findConfiguration(nameOf(mvcType)), mvcId, Collections.&lt;String, Object&gt;emptyMap());</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull Map&lt;String, Object&gt; args, @Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId) {
<span class="nc" id="L443">        return createMVC(findConfiguration(nameOf(mvcType)), mvcId, args);</span>
    }

    @Nonnull
    @Override
    public &lt;MVC extends TypedMVCGroup&gt; List&lt;? extends GriffonMvcArtifact&gt; createMVC(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId, @Nonnull Map&lt;String, Object&gt; args) {
<span class="nc" id="L449">        return createMVC(findConfiguration(nameOf(mvcType)), mvcId, args);</span>
    }

    @Override
    public &lt;M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull String mvcType, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L454">        withMVCGroup(findConfiguration(mvcType), null, Collections.&lt;String, Object&gt;emptyMap(), handler);</span>
<span class="nc" id="L455">    }</span>

    @Override
    public &lt;M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull String mvcType, @Nonnull String mvcId, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L459">        withMVCGroup(findConfiguration(mvcType), mvcId, Collections.&lt;String, Object&gt;emptyMap(), handler);</span>
<span class="nc" id="L460">    }</span>

    @Override
    public &lt;M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull String mvcType, @Nonnull String mvcId, @Nonnull Map&lt;String, Object&gt; args, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L464">        withMVCGroup(findConfiguration(mvcType), mvcId, args, handler);</span>
<span class="nc" id="L465">    }</span>

    @Override
    public &lt;M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull Map&lt;String, Object&gt; args, @Nonnull String mvcType, @Nonnull String mvcId, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L469">        withMVCGroup(findConfiguration(mvcType), mvcId, args, handler);</span>
<span class="nc" id="L470">    }</span>

    @Override
    public &lt;M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull String mvcType, @Nonnull Map&lt;String, Object&gt; args, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L474">        withMVCGroup(findConfiguration(mvcType), null, args, handler);</span>
<span class="nc" id="L475">    }</span>

    @Override
    public &lt;M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull Map&lt;String, Object&gt; args, @Nonnull String mvcType, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L479">        withMVCGroup(findConfiguration(mvcType), null, args, handler);</span>
<span class="nc" id="L480">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup, M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L484">        withMVCGroup(findConfiguration(nameOf(mvcType)), null, Collections.&lt;String, Object&gt;emptyMap(), handler);</span>
<span class="nc" id="L485">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup, M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L489">        withMVCGroup(findConfiguration(nameOf(mvcType)), mvcId, Collections.&lt;String, Object&gt;emptyMap(), handler);</span>
<span class="nc" id="L490">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup, M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId, @Nonnull Map&lt;String, Object&gt; args, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L494">        withMVCGroup(findConfiguration(nameOf(mvcType)), mvcId, args, handler);</span>
<span class="nc" id="L495">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup, M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull Map&lt;String, Object&gt; args, @Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L499">        withMVCGroup(findConfiguration(nameOf(mvcType)), mvcId, args, handler);</span>
<span class="nc" id="L500">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup, M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull Map&lt;String, Object&gt; args, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L504">        withMVCGroup(findConfiguration(nameOf(mvcType)), null, args, handler);</span>
<span class="nc" id="L505">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup, M extends GriffonModel, V extends GriffonView, C extends GriffonController&gt; void withMVC(@Nonnull Map&lt;String, Object&gt; args, @Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull MVCFunction&lt;M, V, C&gt; handler) {
<span class="nc" id="L509">        withMVCGroup(findConfiguration(nameOf(mvcType)), null, args, handler);</span>
<span class="nc" id="L510">    }</span>

    @Override
    public void withMVCGroup(@Nonnull String mvcType, @Nonnull MVCGroupFunction handler) {
<span class="nc" id="L514">        withMVCGroup(findConfiguration(mvcType), null, Collections.&lt;String, Object&gt;emptyMap(), handler);</span>
<span class="nc" id="L515">    }</span>

    @Override
    public void withMVCGroup(@Nonnull String mvcType, @Nonnull String mvcId, @Nonnull MVCGroupFunction handler) {
<span class="nc" id="L519">        withMVCGroup(findConfiguration(mvcType), mvcId, Collections.&lt;String, Object&gt;emptyMap(), handler);</span>
<span class="nc" id="L520">    }</span>

    @Override
    public void withMVCGroup(@Nonnull String mvcType, @Nonnull String mvcId, @Nonnull Map&lt;String, Object&gt; args, @Nonnull MVCGroupFunction handler) {
<span class="nc" id="L524">        withMVCGroup(findConfiguration(mvcType), mvcId, args, handler);</span>
<span class="nc" id="L525">    }</span>

    @Override
    public void withMVCGroup(@Nonnull Map&lt;String, Object&gt; args, @Nonnull String mvcType, @Nonnull String mvcId, @Nonnull MVCGroupFunction handler) {
<span class="nc" id="L529">        withMVCGroup(findConfiguration(mvcType), mvcId, args, handler);</span>
<span class="nc" id="L530">    }</span>

    @Override
    public void withMVCGroup(@Nonnull String mvcType, @Nonnull Map&lt;String, Object&gt; args, @Nonnull MVCGroupFunction handler) {
<span class="nc" id="L534">        withMVCGroup(findConfiguration(mvcType), null, args, handler);</span>
<span class="nc" id="L535">    }</span>

    @Override
    public void withMVCGroup(@Nonnull Map&lt;String, Object&gt; args, @Nonnull String mvcType, @Nonnull MVCGroupFunction handler) {
<span class="nc" id="L539">        withMVCGroup(findConfiguration(mvcType), null, args, handler);</span>
<span class="nc" id="L540">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup&gt; void withMVCGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull TypedMVCGroupFunction&lt;MVC&gt; handler) {
<span class="nc" id="L544">        withMVCGroup(mvcType, null, Collections.&lt;String, Object&gt;emptyMap(), handler);</span>
<span class="nc" id="L545">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup&gt; void withMVCGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId, @Nonnull TypedMVCGroupFunction&lt;MVC&gt; handler) {
<span class="nc" id="L549">        withMVCGroup(mvcType, mvcId, Collections.&lt;String, Object&gt;emptyMap(), handler);</span>
<span class="nc" id="L550">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup&gt; void withMVCGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId, @Nonnull Map&lt;String, Object&gt; args, @Nonnull TypedMVCGroupFunction&lt;MVC&gt; handler) {
<span class="nc" id="L554">        MVC group = null;</span>
        try {
<span class="nc" id="L556">            group = createMVCGroup(mvcType, mvcId, args);</span>
<span class="nc" id="L557">            handler.apply(group);</span>
        } finally {
<span class="nc" id="L559">            try {</span>
<span class="nc bnc" id="L560" title="All 4 branches missed.">                if (group != null) {</span>
<span class="nc" id="L561">                    destroyMVCGroup(group.getMvcId());</span>
                }
<span class="nc" id="L563">            } catch (Exception x) {</span>
<span class="nc" id="L564">                LOG.warn(&quot;Could not destroy group [{}] of type {}&quot;, mvcId, nameOf(mvcType), sanitize(x));</span>
<span class="nc" id="L565">            }</span>
<span class="nc" id="L566">        }</span>
<span class="nc" id="L567">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup&gt; void withMVCGroup(@Nonnull Map&lt;String, Object&gt; args, @Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull String mvcId, @Nonnull TypedMVCGroupFunction&lt;MVC&gt; handler) {
<span class="nc" id="L571">        withMVCGroup(mvcType, mvcId, args, handler);</span>
<span class="nc" id="L572">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup&gt; void withMVCGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull Map&lt;String, Object&gt; args, @Nonnull TypedMVCGroupFunction&lt;MVC&gt; handler) {
<span class="nc" id="L576">        withMVCGroup(mvcType, null, args, handler);</span>
<span class="nc" id="L577">    }</span>

    @Override
    public &lt;MVC extends TypedMVCGroup&gt; void withMVCGroup(@Nonnull Map&lt;String, Object&gt; args, @Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull TypedMVCGroupFunction&lt;MVC&gt; handler) {
<span class="nc" id="L581">        withMVCGroup(mvcType, null, args, handler);</span>
<span class="nc" id="L582">    }</span>

    @Nonnull
    @Override
    public &lt;C extends GriffonController&gt; C getController(@Nonnull String name, @Nonnull Class&lt;C&gt; type) throws ArtifactNotFoundException {
<span class="nc" id="L587">        requireNonBlank(name, ERROR_NAME_BLANK);</span>
<span class="nc" id="L588">        requireNonNull(type, ERROR_TYPE_NULL);</span>
<span class="nc" id="L589">        GriffonController controller = getControllers().get(name);</span>
<span class="nc bnc" id="L590" title="All 2 branches missed.">        if (controller != null) {</span>
<span class="nc" id="L591">            return type.cast(controller);</span>
        }
<span class="nc" id="L593">        throw new ArtifactNotFoundException(type, name);</span>
    }

    @Nonnull
    @Override
    public &lt;M extends GriffonModel&gt; M getModel(@Nonnull String name, @Nonnull Class&lt;M&gt; type) throws ArtifactNotFoundException {
<span class="nc" id="L599">        requireNonBlank(name, ERROR_NAME_BLANK);</span>
<span class="nc" id="L600">        requireNonNull(type, ERROR_TYPE_NULL);</span>
<span class="nc" id="L601">        GriffonModel model = getModels().get(name);</span>
<span class="nc bnc" id="L602" title="All 2 branches missed.">        if (model != null) {</span>
<span class="nc" id="L603">            return type.cast(model);</span>
        }
<span class="nc" id="L605">        throw new ArtifactNotFoundException(type, name);</span>
    }

    @Nonnull
    @Override
    public &lt;V extends GriffonView&gt; V getView(@Nonnull String name, @Nonnull Class&lt;V&gt; type) throws ArtifactNotFoundException {
<span class="nc" id="L611">        requireNonBlank(name, ERROR_NAME_BLANK);</span>
<span class="nc" id="L612">        requireNonNull(type, ERROR_TYPE_NULL);</span>
<span class="nc" id="L613">        GriffonView view = getViews().get(name);</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">        if (view != null) {</span>
<span class="nc" id="L615">            return type.cast(view);</span>
        }
<span class="nc" id="L617">        throw new ArtifactNotFoundException(type, name);</span>
    }

    @Nullable
    @Override
    public &lt;C extends GriffonController&gt; C findController(@Nonnull String name, @Nonnull Class&lt;C&gt; type) {
        try {
<span class="nc" id="L624">            return getController(name, type);</span>
<span class="nc" id="L625">        } catch (ArtifactNotFoundException anfe) {</span>
<span class="nc" id="L626">            return null;</span>
        }
    }

    @Nullable
    @Override
    public &lt;M extends GriffonModel&gt; M findModel(@Nonnull String name, @Nonnull Class&lt;M&gt; type) {
        try {
<span class="nc" id="L634">            return getModel(name, type);</span>
<span class="nc" id="L635">        } catch (ArtifactNotFoundException anfe) {</span>
<span class="nc" id="L636">            return null;</span>
        }
    }

    @Nullable
    @Override
    public &lt;V extends GriffonView&gt; V findView(@Nonnull String name, @Nonnull Class&lt;V&gt; type) {
        try {
<span class="nc" id="L644">            return getView(name, type);</span>
<span class="nc" id="L645">        } catch (ArtifactNotFoundException anfe) {</span>
<span class="nc" id="L646">            return null;</span>
        }
    }

    @Nonnull
    protected &lt;MVC extends TypedMVCGroup&gt; String nameOf(@Nonnull Class&lt;? extends MVC&gt; mvcType) {
<span class="nc" id="L652">        return AnnotationUtils.nameFor(mvcType, true);</span>
    }

    @Nonnull
    protected &lt;MVC extends TypedMVCGroup&gt; MVC typedMvcGroup(@Nonnull Class&lt;? extends MVC&gt; mvcType, @Nonnull MVCGroup mvcGroup) {
        try {
<span class="nc" id="L658">            Constructor&lt;? extends MVC&gt; constructor = mvcType.getDeclaredConstructor(MVCGroup.class);</span>
<span class="nc" id="L659">            return constructor.newInstance(mvcGroup);</span>
<span class="nc" id="L660">        } catch (Exception e) {</span>
<span class="nc" id="L661">            throw new MVCGroupInstantiationException(&quot;Unexpected error&quot;, mvcGroup.getMvcType(), mvcGroup.getMvcId(), e);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>